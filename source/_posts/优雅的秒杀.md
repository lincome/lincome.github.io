---
title: 优雅的秒杀
date: 2022-10-17 12:07:26
tags:
  - redis
  - rabbitMQ
  - 秒杀
  - 超卖
---
单体：
1、让前端在提交订单后，显示“排队中”

    秒杀接口：
    1、检查缓存中该用户是否已经下单过：在消息队列下单成功后写入redis一条用户id和商品id绑定的数据
    2、检查缓存是否有库存（没有的话查询mysql写入缓存）（redis和mysql一致性处理）
    3、有库存加入队列
    4、队列：
        查库存
        mysql乐观锁减库存
        删缓存
        写订单到mysql
        写入订单至缓存供查询

2、查询秒杀接口，检查用户和商品是否已经有订单的接口

    前端不断请求
    很抱歉，你的订单尚未生成，继续排队。（秒杀成功队列处理中）
    如果得到订单已经处理完成的消息，页面跳转抢购成功。
